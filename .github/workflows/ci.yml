name: CI (Python uv)
on:
  pull_request: {}
  push:
    branches: [main]
  workflow_dispatch:
    inputs:
      debug_mode:
        description: "Enable debug logging for troubleshooting"
        required: false
        type: boolean
        default: false

permissions:
  # Minimal permissions for CI workflow
  contents: read

jobs:
  # Run tests and linting for Python projects using uv package manager
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository code
        # Pin to specific commit SHA for security
        # actions/checkout@v4.1.7 (August 2024)
        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332

      - name: Install uv
        # Use official astral-sh/setup-uv action
        uses: astral-sh/setup-uv@v6
        with:
          enable-cache: true

      - name: Set up Python
        # Let uv manage Python installation
        run: uv python install

      - name: Install project dependencies
        run: |
          echo "üì¶ Installing project dependencies..."
          uv sync --locked --all-extras --dev

      - name: Run test suite
        run: |
          echo "üß™ Running test suite..."
          uv run pytest -v --tb=short || echo "‚ö†Ô∏è No pytest found - add pytest to your dependencies to enable testing"

      - name: Run code quality checks
        run: |
          echo "üîç Running code quality checks..."
          # Run ruff if available
          uv run ruff check . || echo "‚ÑπÔ∏è Ruff not installed"
          
          # Run black if available  
          uv run black --check . || echo "‚ÑπÔ∏è Black not installed"
          
          # Run mypy if available
          uv run mypy . || echo "‚ÑπÔ∏è Mypy not installed"
